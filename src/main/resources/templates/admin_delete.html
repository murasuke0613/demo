<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ÁÆ°ÁêÜËÄÖÔºöÂâäÈô§„Éö„Éº„Ç∏</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
        }
        .navbar {
            backdrop-filter: blur(6px);
            background-color: rgba(13, 110, 253, 0.85);
        }
        th.sortable {
            cursor: pointer;
        }
        th.sortable::after {
            content: " ‚¨ç";
            font-size: 0.8em;
            color: #888;
        }
        .disabled-button {
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>
<body>

<!-- ‚úÖ „Éò„ÉÉ„ÉÄ„Éº -->
<nav class="navbar navbar-expand-lg navbar-dark shadow">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" th:href="@{/home}">
      <i class="bi bi-house-door-fill"></i> „Éõ„Éº„É†
    </a>
    <div class="ms-auto text-white">
      <i class="bi bi-person-circle"></i> 
      <span th:text="${loginUser.userName}">„É¶„Éº„Ç∂„ÉºÂêç</span>
      (<span th:text="${loginUser.userId}">„É¶„Éº„Ç∂„ÉºID</span>)
      <a th:href="@{/logout}" class="btn btn-sm btn-outline-light ms-3">
        <i class="bi bi-box-arrow-right"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
      </a>
    </div>
  </div>
</nav>

<div class="container mt-5">
    <h2 class="mb-4"><i class="bi bi-tools"></i> ÁÆ°ÁêÜËÄÖÔºöÂâäÈô§„Éö„Éº„Ç∏</h2>

    <div th:if="${loginUser == null or loginUser.adminFlag == null or loginUser.adminFlag == false}">
        <div class="alert alert-danger mt-3">
            <i class="bi bi-shield-lock-fill"></i> „Åì„ÅÆ„Éö„Éº„Ç∏„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ„Åß„Åô„ÄÇ
        </div>
        <a th:href="@{/home}" class="btn btn-primary mt-2">„Éõ„Éº„É†„Å´Êàª„Çã</a>
    </div>

    <div th:if="${loginUser != null and loginUser.adminFlag == true}">
        <!-- „Çø„Éñ -->
        <ul class="nav nav-tabs mt-3" id="deleteTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button" role="tab">
                    <i class="bi bi-person-dash-fill"></i> „É¶„Éº„Ç∂„ÉºÂâäÈô§
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="department-tab" data-bs-toggle="tab" data-bs-target="#department" type="button" role="tab">
                    <i class="bi bi-building-dash"></i> ÈÉ®ÁΩ≤ÂâäÈô§
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="job-tab" data-bs-toggle="tab" data-bs-target="#job" type="button" role="tab">
                    <i class="bi bi-briefcase-dash"></i> ËÅ∑Á®ÆÂâäÈô§
                </button>
            </li>
        </ul>

        <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div class="tab-content" id="deleteTabsContent">

            <!-- üßë‚Äçüíº „É¶„Éº„Ç∂„ÉºÂâäÈô§ -->
            <div class="tab-pane fade show active" id="user" role="tabpanel">
                <table class="table table-hover mt-3 shadow-sm rounded">
                    <thead class="table-primary">
                        <tr>
                            <th class="sortable" onclick="sortTable(0, 'userTable')">„É¶„Éº„Ç∂„ÉºÂêç</th>
                            <th class="sortable" onclick="sortTable(1, 'userTable')">ÈÉ®ÁΩ≤</th>
                            <th class="sortable" onclick="sortTable(2, 'userTable')">ËÅ∑Á®Æ</th>
                            <th class="sortable" onclick="sortTable(3, 'userTable')">ÁÆ°ÁêÜËÄÖ</th>
                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                        </tr>
                    </thead>
                    <tbody id="userTable">
                        <tr th:each="user : ${userList}">
                            <td th:text="${user.userName}">„É¶„Éº„Ç∂„ÉºÂêç</td>
                            <td th:text="${user.department.departmentName}">ÈÉ®ÁΩ≤Âêç</td>
                            <td th:text="${user.job.jobName}">ËÅ∑Á®ÆÂêç</td>
                            <td>
                                <span th:if="${user.adminFlag}" class="badge bg-success">‚úî ÁÆ°ÁêÜËÄÖ</span>
                                <span th:if="${!user.adminFlag}" class="badge bg-secondary">‰∏ÄËà¨</span>
                            </td>
                            <td>
                                <!-- ÂâäÈô§Á¶ÅÊ≠¢Êù°‰ª∂ -->
                                <div th:if="${user.userKey != loginUser.userKey}">
									<form th:action="@{/admin/delete/user/{key}(key=${user.userKey})}" method="post" 
									      onsubmit="return confirm('Êú¨ÂΩì„Å´„Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                                        <button type="submit" class="btn btn-sm btn-danger">
                                            <i class="bi bi-trash"></i> ÂâäÈô§
                                        </button>
                                    </form>
                                </div>
                                <span th:if="${user.userKey == loginUser.userKey}" class="text-muted">
                                    <i class="bi bi-lock-fill"></i> Ëá™ÂàÜ
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- üè¢ ÈÉ®ÁΩ≤ÂâäÈô§ -->
            <div class="tab-pane fade" id="department" role="tabpanel">
                <table class="table table-hover mt-3 shadow-sm rounded">
                    <thead class="table-secondary">
                        <tr>
                            <th>ÈÉ®ÁΩ≤Âêç</th>
                            <th>ÊâÄÂ±û‰∫∫Êï∞</th>
                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="dept : ${departmentList}">
                            <td th:text="${dept.departmentName}">ÈÉ®ÁΩ≤Âêç</td>
                            <td th:text="${dept.userCount}">0</td>
                            <td>
                                <form th:action="@{/admin/delete/department/{id}(id=${dept.departmentId})}" method="post" 
                                      onsubmit="return confirm('Êú¨ÂΩì„Å´„Åì„ÅÆÈÉ®ÁΩ≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                                    <button type="submit" 
                                            th:disabled="${dept.userCount > 0}" 
                                            th:classappend="${dept.userCount > 0} ? 'disabled-button btn-secondary' : 'btn-danger'"
                                            class="btn btn-sm">
                                        <i class="bi bi-trash"></i> ÂâäÈô§
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- üõ† ËÅ∑Á®ÆÂâäÈô§ -->
            <div class="tab-pane fade" id="job" role="tabpanel">
                <table class="table table-hover mt-3 shadow-sm rounded">
                    <thead class="table-warning">
                        <tr>
                            <th>ËÅ∑Á®ÆÂêç</th>
                            <th>ÊâÄÂ±û‰∫∫Êï∞</th>
                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="job : ${jobList}">
                            <td th:text="${job.jobName}">ËÅ∑Á®ÆÂêç</td>
                            <td th:text="${job.userCount}">0</td>
                            <td>
                                <form th:action="@{/admin/delete/job/{id}(id=${job.jobId})}" method="post" 
                                      onsubmit="return confirm('Êú¨ÂΩì„Å´„Åì„ÅÆËÅ∑Á®Æ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                                    <button type="submit" 
                                            th:disabled="${job.userCount > 0}" 
                                            th:classappend="${job.userCount > 0} ? 'disabled-button btn-secondary' : 'btn-danger'"
                                            class="btn btn-sm">
                                        <i class="bi bi-trash"></i> ÂâäÈô§
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function sortTable(columnIndex, tableId) {
        const table = document.getElementById(tableId);
        const rows = Array.from(table.querySelectorAll("tr"));
        const sortedRows = rows.sort((a, b) => {
            const aText = a.children[columnIndex].innerText;
            const bText = b.children[columnIndex].innerText;
            return aText.localeCompare(bText, "ja");
        });
        rows.forEach(row => table.appendChild(row));
    }
</script>
</body>
</html>
